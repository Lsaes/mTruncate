(function(a){a.fn.mtruncate=function(b){var c=a.extend({maxLines:11,expandText:"Expand",collapseText:"Collapse",hideImageOnCollapse:true},b);return this.each(function(){var e=a(this).css("overflow","hidden");var i=e.wrap('<div class="mTruncate-wrapper mTruncate-collapsed" />').parent();var h=a('<div class="mTruncate-control">'+c.expandText+"</div>").appendTo(i);var d=0;var g=0;function f(k,j){if(k==true){d=0;g=0}j.each(function(){if(this.nodeType==8){return true}var n=a(this).prop("tagName");if(typeof n=="undefined"){var p=this.textContent.trim();if(p.length==0){return true}var m=a(this).parent();var l=m.height();var o=parseFloat(m.css("line-height"));var q=Math.round(l/o);d+=parseFloat(m.css("margin-top"));if((g+q)>=c.maxLines){q=(c.maxLines-g)}d+=q*o;g+=q;if(g<c.maxLines){d+=parseFloat(m.css("margin-bottom"))}return true}if(n.indexOf("H")==0&&n.length==2&&!isNaN(n[1])){d+=a(this).height();d+=parseFloat(a(this).css("margin-top"));d+=parseFloat(a(this).css("margin-bottom"));g++}else{if(n.toLowerCase()=="img"){if(c.hideImageOnCollapse){if(a(this).hasClass("mTruncate-hidden")==false){a(this).addClass("mTruncate-hidden")}return true}d+=a(this).height();d+=parseFloat(a(this).css("margin-top"));d+=parseFloat(a(this).css("margin-bottom"));g++}else{if(a(this).contents().length!=0){f(false,a(this).contents())}}}if(g>=c.maxLines){return false}})}a(window).resize(function(){f(true,e.contents());if(i.hasClass("mTruncate-collapsed")){e.height(d)}}).trigger("resize");h.click(function(){if(i.hasClass("mTruncate-collapsed")){a(".mTruncate-hidden").show();var j=e.css("height","100%").outerHeight();a(".mTruncate-hidden").hide();e.css("height",d);e.animate({height:j},"slow",function(){e.css("height","")});h.html(c.collapseText);a(".mTruncate-hidden").fadeIn("slow");i.removeClass("mTruncate-collapsed")}else{if(c.hideImageOnCollapse==true){a(".mTruncate-hidden").fadeOut("slow")}e.animate({height:d},"slow");h.html(c.expandText);i.addClass("mTruncate-collapsed")}})})}}(jQuery));